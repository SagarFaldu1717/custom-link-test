<!DOCTYPE html>
<html>
<head>
    <title>Custom Link</title>
    <style>
        /* Light blue button style */
        #redirectButton {
            background-color: #add8e6; /* Light blue color */
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 5px;
        }

        #redirectButton:hover {
            background-color: #87ceeb; /* Slightly darker blue on hover */
        }
    </style>
</head>
<body>
    <h1>Custom Link</h1>
    <p>Click the button below to open the iOS app or go to the App Store:</p>
    
    <!-- Button to trigger the custom URL scheme and App Store fallback -->
    <button id="redirectButton">Open iOS App</button>

<script>
        document.getElementById('redirectButton').addEventListener('click', function () {
            // Define your app's custom URL and the App Store fallback URL
            const appURL = 'https://tel-qa-api.telescopehealth.com/app-facade/redirect-url/m5v2?domain=tel-qa-pp';
            const appStoreURL = 'https://apps.apple.com/app/id6670623240';
            let fallbackTimeout;

            // Function to handle the redirection to the App Store
            const redirectToAppStore = function () {
                // Only redirect if the page is still visible
                if (document.visibilityState === 'visible') {
                    window.location.href = appStoreURL;
                }
            };

            // Set a timer to redirect to the App Store
            fallbackTimeout = setTimeout(redirectToAppStore, 2000); // 2-second delay

            // Add a one-time event listener for the visibilitychange event
            document.addEventListener('visibilitychange', function onVisibilityChange() {
                // If the page becomes hidden, the app likely opened.
                // Clear the timeout to prevent redirection to the App Store.
                if (document.visibilityState === 'hidden') {
                    clearTimeout(fallbackTimeout);
                    // Remove the event listener to avoid it firing again
                    document.removeEventListener('visibilitychange', onVisibilityChange);
                }
            });

            // Attempt to open the custom URL scheme
            window.location.href = appURL;
        });
    </script>
</body>
</html>
